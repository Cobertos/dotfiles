- name: Sublime Text 3 - Windows
  when: ansible_facts['os_family'] == "Windows"
  block:
    - name: Add to path
      win_path:
        elements:
        - 'C:\Program Files\Sublime Text 3'
    - name: Symlink user files
      win_shell: cmd /k mklink {{ playbook_dir }}\sublime\APPDATA\Packages\User "%APPDATA%\Sublime Text 3\Packages\User"

- name: Sublime Text 3 - Linux
  when: ansible_facts['os_family'] != "Windows"
  block:
    - name: Install apt keys
      become: yes
      apt_key:
        url: https://download.sublimetext.com/sublimehq-pub.gpg
    - name: Install apt repositories
      become: yes
      apt_repository:
        repo: deb https://download.sublimetext.com/ apt/stable/
    - name: Install apt packages
      become: yes
      package:
        name: sublime-text
    - name: Check the current Symlink
      stat:
        path: ~/.config/sublime-text-3/Packages/User
      register: user_symlink
    - name: Remove current folder if present
      when: user_symlink.stat.isdir is defined and user_symlink.stat.isdir
      file:
        path: ~/.config/sublime-text-3/Packages/User
        state: absent
    - name: Symlink data files on Linux
      file:
        src: '{{ playbook_dir }}/sublime/APPDATA/Packages/User'
        dest: ~/.config/sublime-text-3/Packages/User
        state: link
        force: yes